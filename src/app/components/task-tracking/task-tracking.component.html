<div class="page">

  <!-- SIDE MENU -->
  <aside class="side-menu">
    <h3 class="menu-title">MENU</h3>

    <button
      class="menu-item"
      routerLink="/profile"
      routerLinkActive="active"
      [routerLinkActiveOptions]="{ exact: true }">
      ğŸ  Dashboard
    </button>

    <button
      *ngIf="role === 'user'"
      class="menu-item"
      routerLink="/tracking"
      routerLinkActive="active">
      ğŸ“ Tasks
    </button>

    <button
      class="menu-item"
      routerLink="/calendar"
      routerLinkActive="active">
      ğŸ“… Calendar
    </button>

    <button
      *ngIf="role === 'helper'"
      class="menu-item"
      routerLink="/helper/requests"
      routerLinkActive="active">
      ğŸ“Š Task Request
    </button>
        <!-- TEAM -->
    <button
      class="menu-item"
      routerLink="/team"
      routerLinkActive="active">
      ğŸ‘¥ Chat
    </button>

    <button class="menu-item back-btn" (click)="goBack()">â¬… Back</button>
  </aside>

  <!-- CONTENT -->
  <div class="content">

    <h1 class="page-title">Task Tracking</h1>

    <p *ngIf="loading">Loading...</p>

    <p *ngIf="!loading && tasks.length === 0" class="empty">
      No tasks found
    </p>

    <!-- TASK GRID -->
    <div class="task-grid" *ngIf="!loading && tasks.length">

      <div class="profile-card task-card" *ngFor="let task of tasks">

        <h2 class="task-title">{{ task.helpername }}</h2>

        <div class="task-info">
          <p><span>Date</span>{{ formatDate(task.calendar) }}</p>
          <p><span>Time</span>{{ task.time }}</p>
          <p><span>Location</span>{{ task.location }}</p>
          <p><span>Payment</span>{{ task.payment_method }}</p>
          <p><span>Amount</span>â‚¹{{ task.amount }}</p>
          <p>
            <span>Status</span>
            <b [class.done]="task.task_status === 'completed'">
              {{ task.task_status }}
            </b>
          </p>
        </div>

        <!-- USER ACTIONS -->
        <div *ngIf="role === 'user'">

          <!-- COMPLETE (ONLY WHEN ACCEPTED) -->
          <button
            class="complete-btn"
            *ngIf="task.task_status === 'accepted' || task.task_status === 'in_progress'"
            (click)="completeTask(task)">
            Slide to Complete â†’
          </button>

          <!-- REVIEW (ONLY WHEN COMPLETED) -->
          <div *ngIf="task.task_status === 'completed'">

            <!-- STAR RATING -->
            <div class="stars">
              <span
                *ngFor="let s of [1,2,3,4,5]"
                (click)="setRating(task, s)"
                [class.active]="s <= task.userRating"
                [class.disabled]="task.submitted">
                â˜…
              </span>
            </div>

            <!-- REVIEW TEXT -->
            <textarea
              [(ngModel)]="task.userReview"
              placeholder="Write your review..."
              [disabled]="task.submitted">
            </textarea>

            <!-- SUBMIT -->
            <button
              class="submit-btn"
              (click)="submitReview(task)"
              [disabled]="task.submitted">
              {{ task.submitted ? 'Review Submitted âœ”' : 'Submit Review' }}
            </button>

          </div>
        </div>

      </div>
    </div>

  </div>
</div>
