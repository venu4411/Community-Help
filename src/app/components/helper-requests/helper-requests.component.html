<div class="page">

  <!-- SIDE MENU -->
  <aside class="side-menu">
    <h3 class="menu-title">MENU</h3>

    <button class="menu-item" routerLink="/profile">ğŸ  Dashboard</button>
    <button class="menu-item" routerLink="/calendar">ğŸ“… Calendar</button>

    <button class="menu-item active">ğŸ“Š Task Request</button>
    <button class="menu-item">ğŸ‘¥ Chat</button>

    <button class="menu-item back-btn" (click)="goBack()">â¬… Back</button>
  </aside>

  <!-- MAIN CONTENT -->
  <div class="content">
    <h1 class="page-title">Pending Help Requests</h1>

    <p class="empty" *ngIf="!tasks.length">No pending requests</p>

    <div class="task-grid">

      <div class="profile-card" *ngFor="let t of tasks">

        <h3 class="task-title">{{ t.username }}</h3>

        <div class="task-info">
          <p><span>Date</span><b>{{ t.calendar | date:'dd/MM/yyyy' }}</b></p>
          <p><span>Time</span><b>{{ t.time }}</b></p>
          <p><span>Location</span><b>{{ t.location }}</b></p>
          <p><span>Payment</span><b>{{ t.payment_method }}</b></p>
          <p><span>Amount</span><b>â‚¹{{ t.amount }}</b></p>
          <p><span>Status</span><b>{{ t.task_status }}</b></p>
        </div>

        <!-- ACCEPT BUTTON -->
        <button
          class="complete-btn"
          *ngIf="t.task_status === 'pending'"
          (click)="acceptTask(t.id)">
          Accept â†’
        </button>

        <!-- ğŸ” PIN VERIFICATION (AFTER ACCEPTED / IN_PROGRESS) -->
        <div class="pin-wrapper"
             *ngIf="t.task_status === 'in_progress'">

          <p class="pin-label">Enter Tracking PIN</p>

          <div class="pin-boxes">
            <input
              class="pin-input"
              maxlength="1"
              *ngFor="let i of [0,1,2,3]; let idx = index"
              (input)="onPinInput($event, idx, t)"
            />
          </div>

          <button class="verify-btn" (click)="verifyPin(t)">
            Verify PIN & Start Work
          </button>

        </div>

        <!-- WORK STARTED -->
        <p *ngIf="t.task_status === 'work_in_progress'"
           class="work-started">
          âœ… Work In Progress
        </p>

      </div>
    </div>
  </div>
</div>
